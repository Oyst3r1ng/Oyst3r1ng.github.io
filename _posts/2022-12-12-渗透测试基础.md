---
layout: mypost
title: "渗透测试基础"
categories: [Web 安全]
---

## 渗透测试介绍以及注意事项

### 渗透测试介绍

渗透测试 (penetration test)并没有一个标准的定义，国外一些安全组织达成共识的通用说法是：渗透测试是通过模拟恶意黑客的攻击方法，来评估计算机网络系统安全的一种评估方法。这个过程包括对系统的任何弱点、技术缺陷或漏洞的主动分析，这个分析是从一个攻击者可能存在的位置来进行的，并且从这个位置有条件主动利用安全漏洞

换句话来说，渗透测试是指渗透人员在不同的位置（比如从内网、从外网等位置）利用各种手段对某个特定网络进行测试，以期发现和挖掘系统中存在的漏洞，然后输出渗透测试报告，并提交给网络所有者，网络所有者根据渗透人员提供的渗透测试报告，可以清晰知晓系统中存在的安全隐患和问题

阐述一下总体的过程：现在一台服务器可能会开有好多好多的服务，比如 Web 服务，FTP 服务，和一些中间件服务，3389 等等，这些服务可能都是存在一些漏洞的，只要利用的到位，每一个服务都可能拿到这台服务器的权限，但 Web 服务方面相比于其他服务的漏洞是更多的，所以我们一般会从 Web 服务方面入手去渗透打点，当拿到一台服务器权限后，我们就可以在内网里面**横向渗透**（就是看与这台服务器同一网段有什么机器）或者是**纵向渗透**（一个公司肯定不可能是一个网段，纵向渗透就是看别的网段，这个可能就要找到一台双网卡的机器），这样一来就在内网相当于漫游了，中间逐步去收集这个公司的一些重要资产，渗透测试就是模拟黑客从公司的网络边缘地带到核心地带一步一步去测试有无漏洞，渗透测试完了，反过来再去生成报告，记录每一步是否安全的，并提出修复建议

![](image-20231121121932029.png)

### 注意事项

- 不要进行恶意攻击

- 不要做傻事

- 在没有获得书面授权时，不要攻击任何目标

- 考虑你的行为将会带来的后果

- 如果你干了非法的是，天网恢恢疏而不漏

- 遵循国家法律法规

- 但其实后面也会有一些反追踪的方法，让自己不会被轻易的查到，这个之后再说吧

### 运行程序的一些快捷指令

- cmd：这个用 shell

- calc：这个弹计算器

- mspaint：这个弹画板

- control：这个是控制面板

- inetmgr：这个在服务器系统的话，会弹出服务器控制面板

- uac：就是按下 win 键，然后搜索 uac，这个就是平时运行某些程序时，需不需要管理员权限

## 安全术语介绍

- 脚本（asp,php,jsp）：这个就是网站服务器上跑的一些语言

- html（css，js，html）：这是就是前端语言，前端页面展示的这些，浏览器直接 f12 就能看到

- HTTP 协议：浏览器发送信息到服务器就是走的这个协议，后面抓包的时候就会看到 这里说到 HTTP 协议里面的 Host 参数，Host 参数就是可以记录目的 ip 地址端口，以及访问域名什么的，这里简单举个栗子：目前很多一个 ip 对应多个域名的情况（nginx 虚拟主机的实现原理），在 http 请求头中有 host 字段，该字段默认为请求的 url 也可以自己设定，当我们发送一个请求时，先通过 DNS 域名解析，得到 ip，然后建立 tcp 连接，当服务器（以 nginx 为例）收到请求时，就会解析 http 请求 host 字段来判断你是访问的那个 server 配置下的代码，这样 就可以实现在一个服务器上通过 http 的 host 字段实现虚拟服务器，不然就太浪费服务器资源了，这也是一种很常见的搭建旁站的思路

- CMS 和框架：CMS 就是成品房子，框架就是没有砖的房子 这里有个比较骚气的方法，其实就和蜜罐一样，就是找一个老域名，搞一台服务器，然后在这台服务器上面去搭建各种版本的各种框架的网站，说不定哪天 0day 去做批量测试的时候，你就能捕获到这个 0day，然后用别人发现的 0day 去攻击其他网站，或者是去做一些预防措施

- 黑盒白盒：黑盒就是不知道源代码，盲测漏洞，白盒就是去审计源代码去发现漏洞

- MD5/加盐（salt）：就是一种加密的算法，这个一般在网站用户密码管理员密码用的较多，都是这样子加密的，一些网站防止密码破解的话，会做以下一些措施

  - 密码复杂化，这个很复杂的话那也没办法，但一般的话管理员都会有多个账号，这个破解不出来换一个

  - md5 值复杂化，可能就是一个很简单的一个密码，MD5 加密后也能破解出来，但是有的网站会在加密后的字符串里面去加了点字符，干扰破解，可能正常情况下 md5 是 16 位或者是 32 位的，那得到一个 20 位的加密字符串，就要 kaolv 是不是做了混淆

  - 加盐，所谓加盐的意思就是，比如 12345 加密完后是 qwerty，但是又会将 qwerty+67890 再进行一次 MD5，得到一个 wertyu，最终数据库里面储存的也是 wertyu，这个破解的话，其实有这个 salt 就行，而这个 salt 一般数据库那个表名就叫 salt，就是一般在数据库里面一些奇怪的字符串就可能是 salt，这个在 cmd5 那个网站上也有相关的破解方法，最多的可能就是那个 joomla 和 dz 加盐方式

- 肉鸡，抓鸡，ddos，cc：肉鸡就是你的机器已经被控制了，抓鸡就是控制你的机器，ddos 就是发动大量的肉鸡去攻击服务器，当然这只是其中一种攻击方式，还可以泛洪之类的，cc 就是走代理，然后访问服务器，耗 CPU 的资源，代理就是和 burpsuite 抓包一个道理，访问服务器记录的是代理的 IP，而不是真实 IP，可以爬虫爬免费代理，也可以买代理池

- rookit：就是系统内核级后门，权限维持的东西，很难被发现的后门

- poc&exp：poc 就是指漏洞验证，exp 就是指漏洞利用，msf 里面也会有这个

## 搭建安全测试环境

### Vmware 虚拟机的安装和使用

这个下载好，我个人用的是 Vmware16.0pro，然后再网上下所要的虚拟机镜像即可（就是那个 iso 文件）,然后安装就行，跟上网上的步骤一步一步走就行，这里重点还是来说一下关于虚拟机上网的一些东西，这里在日后搭建域环境的时候也是一定要知道的，就说三种比较常见的吧，我也在网上找了一些拓朴图

- **桥接模式**

桥接模式的话，就是将主机网卡与虚拟的网卡利用虚拟网桥进行通信，类似于把物理主机虚拟为一个交换机，所有桥接设置的虚拟机连接到这个交换机的一个接口上，物理主机也同样插在这个交换机当中，所以所有桥接下的网卡与网卡都是交换模式的，相互可以访问而不干扰；我来举个例子，就是我的 win11 现在连的 WiFi 是公司的路由器，那么把一台虚拟机桥接的话，就相当于公司多了一台真实的电脑，这个虚拟机的 IP 地址和主机 win11 的 ip 地址都是属于公司路由器这个网段的，下面给个拓扑图

![](image-20231121153026782.png)

- **NAT 模式**

大家如果看懂了上面那个桥接模式，有没有一种感觉，这种桥接模式下会浪费本来就很稀缺的内网 IP 地址，而这个 NAT 模式就好很多了，在 NAT 模式中，主机网卡直接与虚拟 NAT 设备相连，然后虚拟 NAT 设备与虚拟 DHCP 服务器一起连接在虚拟交换机 VMnet8 上，这样就实现了虚拟机联网，VMware Network Adapter VMnet8 网卡只是为了实现主机与虚拟机之间的通信，就算没有这块虚拟网卡，虚拟机也能上网，这块网卡就是为了让主机和虚拟机同处于一个局域网段，然后相互之间能 ping 通，可以把主机理解为双网卡

![](image-20231121153556476-1024x600.png)

可见 NAT 模式下主机更像是虚拟机们的"路由器"，通过 VMnet8 虚拟网卡（但我感觉主要是 DHCP）为虚拟机分发地址，所以虚拟机和主机不再同一网段下，可以理解为主机是虚拟机的"上级"，这也就是为什么桥接模式没有 VMnet0 这个虚拟网卡，因为桥接模式下的虚拟机和主机是"平等"的，共用同一个路由器呀，则肯定是可以 ping 通的

- **仅主机模式**

仅主机模式可有看成是 NAT 模式去除了虚拟 NAT 设备，然后使用 VMware Network Adapter VMnet1 虚拟网卡连接 VMnet1 虚拟交换机来与虚拟机通信的，Host-Only 模式将虚拟机与外网隔开，使得虚拟机成为一个独立的系统，只与主机相互通讯

![](image-20231121154115678.png)

上面那个图的红线应该是不存在的，它俩网卡正常情况下肯定是不能通信的，但要非要实现仅主机模式下联网，那他俩之间就得共享了

- **关于虚拟机之间 ping 不通**

虚拟机之间 ping 不通的话，首先就是要先检查一下 ping 的那台虚拟机的防火墙是否关掉了，一定是关掉了才能 ping 通，如果还不行的话重启虚拟机，如果再不行的话，重置 Vmware 虚拟机的网络配置

### Web 服务器的搭建

#### 百度的一些搜索语法

- **inurl**：代表搜索的关键词必须在 url 中出现

- **intitle**：代表搜索的关键词必须在网站标题中出现

- **site**：代表搜索的范围限定在这个 site 后面的站点中，这个 site 后面的站点不要带 http：//

- **+**：等于告诉搜索引擎该单词必须出现在搜索结果中的网页上

- **双引号**：如果输入的查询词很长，百度在经过分析后，给出的搜索结果中的查询词，可能是拆分的，如果您对这种情况不满意，可以尝试让百度不拆分查询词，给查询词加上双引号，就可以达到这种效果

- **filetype**：冒号后是文档格式，如 PDF、DOC、XLS 等

#### 常见中间件对应的操作系统

- 一般 03 的 Windows 系统对应的是 IIS6.0

- 一般 08 的 Windows 系统是 IIS7.0 或 7.5

- 一般 12 的 Windows 系统是 IIS8.0 或是 8.5

这个咋去看 IIS 的版本呢？很简单的，其实让网页报个错，每个版本的报错页面都不一样，或者是 F12 看一下数据包，或者指纹识别，很多种方法

#### Web 服务器的搭建过程

这里的话就是用 08 虚拟机来搭一台服务器，这个的话自己看视频搭吧，还是很简单的，简单说一下几个比较重要的点吧

- 网站的内容目录的话就是默认的 C:\\inetpub\\wwwroot\\这个，就在这个目录下面去创建文件夹，然后把源码给放到对应的文件夹里面

- 要是搭建网站访问页面的时候出不了正常的页面，首先就是先保证两个选项都是 True（一个是启用父目录，一个是启用 x32），还不行的话记得看看默认的起始页面是不是 index.asp，因为有的时候默认是 default.asp 的页面

- 绑了域名则必须指定一个确定的 IP 地址

- 服务器上只有一个 IP 时候，端口不能复用

- 一台主机可以添加很多个逻辑 IP，当然一台服务器也可以绑多个 IP 地址，这时候就算是访问同一端口，也不会乱，因为 IP 不一样，有点那种负载均衡的意思在里面

#### 旁站的搭建和利用

服务器搭建多个站的一些方式，这里就说四个吧，后面两个是最常用的，这里拿一个例子来说明吧，比如现在有一个商城的网站，[www.shop.com](www.shop.com)

- 域名相同，IP 相同，端口不相同，比如在域名后面跟个:8081，可能就跳转到了商品页面，加一个:8002，可能就跳转到了购物车页面

- 端口相同（默认 80），IP 不同，这个就是可能域名绑定的 IP 不同，虽然 IP 都在一个服务器上面，但是访问同一个端口的话也不会起冲突

- 相同端口，相同 IP，不同域名，这样的话就是比如访问[www.shangpin.shop.com](www.shangpin.shop.com)这个域名的话，就会到商品页面，访问[www.gouwuche.shop.com](www.gouwuche.shop.com)这个域名就会到购物车页面，这个其实就和 HTTP 请求里面那个 Host 有关了

- 目录建站，这个的话就是直接[www.shop.com/shangpin](www.shop.com/shangpin)就之间跳转到二级目录了，同理[www.shop.com/gouwuche](www.shop.com/gouwuche)也是这样

## 域名解析过程

正常情况下，域名首先的话会先去找 DNS 服务器，这个 IP 地址是固定的，然后 DNS 服务器（如果找不见的话还会往上层一层层的找）把域名解析成 IP 地址返回给客户端，然后客户端再通过 IP 地址去找对应的服务器，但是如果在本地 Hosts 文件里（C:\\Windows\\System32\\drivers\\etc\\hosts），做了相应的修改，那么就不会去 DNS 服务器找了

![](Screenshot_100.png)

## HTTP 协议讲解

- 即超文本传输协议，是一种详细规定了浏览器和万维网服务器之间互相通信的规则，它是万维网交换信息的基础，它允许将 HTML 文档从 Web 服务器传送到 Web 浏览器

- HTTP URL：统一资源定位符(URL 是一种特殊类型的 URL，包含了用于查找某个资源的足够的信息)的格式如下：[http://host](http://host)[":"port](#)，通过这个的话可以探测一些主机信息，比如改个大写，如果能访问，那么服务器就是 Windows 系统，如果改成大写报错，那么服务器就是 Linux 系统；还有就是可以探测网站脚本语言，虽然有些网站做了伪静态（就是不管访问啥，结尾都是 html），一般 jsp 就是这样

- 还有一些常见跟 IP 相关的参数，比如 xff 头，client-ip，remte-ip，还有 refer，这个可能就是有的 WAF 靠这个去判断是不是同一个 IP 一直在攻击，或者是有的时候拿到 admin 账号和密码了，也找到登录后台了，但是登不上去，这个时候就得考虑，是不是检测了登录的 IP，有一个 CMS 就是靠 XFF 去检测的，这个绕过抓包改成上次管理员登录的 IP 就行，但是如果走 TCP 协议获取 IP 的话就不行了，HTTP 获取 IP 的方法就是靠这几个参数

- 讲了一个 IIS 的 PUT 请求的例子，可以将 1.txt 直接传到根目录，然后再用 MOVE 请求，直接将 1.txt 改为 1.php，如果此时 1.asp 是一个一句话木马，那就直接拿 shell 了

- HTTP 的响应码

![](image-20231121173646492-1024x546.png)

但其实 HTTP 很不安全，可能会被窃听，这个在用 bp 扫漏洞，或者 awvs 扫的时候，这个也会被报成一个低危漏洞的，当已经拿下一个旁站，其实就能开个流量监听去抓到他们的访问请求，其实还是很危险的，所以就有了 HTTPS，HTTPS 其实是有两部分组成：HTTP + SSL / TLS，也就是在 HTTP 上又加了一层处理加密信息的模块。服务端和客户端的信息传输都会通过 TLS 进行加密，所以传输的数据都是加密后的数据。